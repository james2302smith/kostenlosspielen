jQuery(function(e){var t=e("#tp-wrapper");e.fn.serializeObject=function(){var t={};var n=this.serializeArray();e.each(n,function(){if(t[this.name]!==undefined){if(!t[this.name].push){t[this.name]=[t[this.name]]}t[this.name].push(this.value||"")}else{t[this.name]=this.value||""}});return t};var n={};t.find(".choice-template").each(function(e,t){n[t.id]=function(e){return t.innerHTML.replace(/\{\{index\}\}/g,e)}});t.find("> .section .title").click(function(t){t.preventDefault();var n=e(this);n.prev(".tab-state").attr("checked",n.parent().hasClass("collapsed")?true:false);n.next(".content").slideToggle(function(){e(this).parent().toggleClass("collapsed")})});t.on("click","[data-toggler]",function(t){if(this.tagName=="A"){t.preventDefault()}e(this).toggleClass("toggled");e('[data-toggle="'+e(this).data("toggler")+'"]').stop().slideToggle(function(){e(this).toggleClass("toggled")})});t.find(".choice-types button").click(function(r){r.preventDefault();var i=n[e(this).data("template")](e(".choices-container > .choice").length);t.find(".choices-container").append(i).trigger("refresh")});t.find(".choices-container").sortable({axis:"y",items:"> .choice",handle:".choice-controllers .move",cancel:"input",containment:"parent",revert:100,tolerance:"pointer",placeholder:"choice-sortable-placeholder",forceHelperSize:true,forcePlaceholderSize:true,update:function(){t.find(".choices-container > .choice").trigger("refresh")}});t.find(".choices-container").on("refresh",function(){t.find(".choices-container").sortable("refresh");t.find(".choices-container .choice").each(function(t){e("input, select, textarea",this).attr("name",function(){this.name=this.name.replace(/tp_options\[choices\]\[(\d+)\]/g,function(e,n,r,i){return e.replace(n,t)})})})});t.on("click",".choice .choice-controllers .delete",function(n){n.preventDefault();e(this).closest(".choice").remove();t.find(".choices-container").trigger("refresh")});t.on("click",".choice .choice-controllers .upload",function(t){t.preventDefault();tb_show("","media-upload.php?thickbox_callback=tp_get_upload&type=image&TB_iframe=true&width=800&height=600&inline=true");e("[data-upload-holder]").removeAttr("data-upload-holder");e(this).closest(".choice").find(".upload-holder").attr("data-upload-holder","")});window.tp_get_upload=function(t){e("[data-upload-holder]").val(e("img",t).attr("src"));tb_remove()};e(".override-votes").change(function(){e(".choices-container").toggleClass("show-votes-fields")});t.find(".datepicker").each(function(){e(this).datepicker()});if(typeof e.farbtastic=="function"){var r='<div class="tp-color-picker"></div>';e(".tp-color-field").focus(function(){e(this).after(r).next(".tp-color-picker").farbtastic(this).slideDown()}).blur(function(){e(this).next(".tp-color-picker").slideUp(function(){e(this).remove()})})}else{e(".tp-color-field").wpColorPicker({change:function(){setTimeout(refreshPreview,0)}})}e(document).on("change",".need-refresh input, .need-refresh textarea, .need-refresh select",function(){refreshPreview()});window.refreshPreview=function(){var t=e(".preview-pane iframe").contents().find("#preview-variables");e(".need-refresh").find("input, textarea, select").each(function(){e("<textarea></textarea>").attr({"class":"hide",name:e(this).attr("name")}).val(e(this).val()).appendTo(t)});t.submit()};e('select[name="tp_options[template][preset][name]"]').on("change",function(t){if(confirm("Are you sure?")){e('input[name="tp_options[template][preset][load]"]').val(e(this).val());e("#publish").click()}else{e(this).val(e(this).find("[selected]").val())}});e('button[name="tp_options[template][preset][new]"]').on("click",function(t){e(this).val(prompt("Preset ID"))});e('button[name="tp_options[template][preset][delete]"]').on("click",function(e){if(!confirm("Are you sure?")){e.preventDefault()}});t.on("click",".customizer a[data-toggler]:not(.toggled)",function(t){e(".customizer a.toggled").not(this).click()});var i=function(){var n=e(window).scrollTop();var r=t.find(".choices-container");var i=t.find(".choice-types");if(n>r.offset().top){if(n+i.outerHeight()<r.offset().top+r.outerHeight()){i.css({marginTop:n-r.offset().top+42})}}else{i.css({marginTop:0})}};e(window).scroll(i)})